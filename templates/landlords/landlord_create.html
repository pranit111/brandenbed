{% extends 'base.html' %}
{% load static %}

{% block title %}Add New Landlord - BrandenBed CRM{% endblock %}

{% block content %}
<div class="w-auto mx-auto">
    <!-- Header Section -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Add New Landlord</h1>
                <p class="text-gray-600">Create a new landlord partnership record for BrandenBed</p>
            </div>
            <a href="{% url 'landlords:landlord_dashboard' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                Back to Dashboard
            </a>
        </div>
    </div>



        <!-- Error Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="mb-4 p-4 rounded-md {% if message.tags == 'error' %}bg-red-50 border border-red-200 text-red-800{% else %}bg-green-50 border border-green-200 text-green-800{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <!-- Form Errors -->
        {% if form.non_field_errors %}
            <div class="mb-4 p-4 rounded-md bg-red-50 border border-red-200">
                {% for error in form.non_field_errors %}
                    <p class="text-red-800">{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Form -->
        <form method="post" class="space-y-8">
            {% csrf_token %}
            
            <!-- Personal Information Section -->
            <div class="bg-white shadow-sm rounded-lg border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Personal Information</h3>
                    <p class="text-sm text-gray-600">Basic personal details and contact information</p>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                First Name <span class="text-red-500">*</span>
                            </label>
                            {{ form.first_name }}
                            {% if form.first_name.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.first_name.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Last Name <span class="text-red-500">*</span>
                            </label>
                            {{ form.last_name }}
                            {% if form.last_name.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.last_name.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Email Address <span class="text-red-500">*</span>
                            </label>
                            {{ form.email }}
                            {% if form.email.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.email.errors|first }}
                                </div>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number
                            </label>
                            {{ form.phone_number }}
                            {% if form.phone_number.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.phone_number.errors|first }}
                                </div>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Address
                            </label>
                            {{ form.address_line_1 }}
                            {% if form.address_line_1.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.address_line_1.errors|first }}
                                </div>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                City
                            </label>
                            {{ form.city }}
                            {% if form.city.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.city.errors|first }}
                                </div>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Postal Code
                            </label>
                            {{ form.pincode }}
                            {% if form.pincode.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.pincode.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Information Section -->
            <div class="bg-white shadow-sm rounded-lg border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Business Information</h3>
                    <p class="text-sm text-gray-600">Company details and partnership information</p>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Landlord Type <span class="text-red-500">*</span>
                            </label>
                            {{ form.landlord_type }}
                            {% if form.landlord_type.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.landlord_type.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Company Name
                            </label>
                            {{ form.company_name }}
                            {% if form.company_name.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.company_name.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                German Tax ID
                            </label>
                            {{ form.tax_id }}
                            {% if form.tax_id.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.tax_id.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Partnership Status <span class="text-red-500">*</span>
                            </label>
                            {{ form.partnership_status }}
                            {% if form.partnership_status.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.partnership_status.errors|first }}
                                </div>
                            {% endif %}
                        </div>

                        <div id="partnership-date-field" class="md:col-span-2" style="display: none;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Partnership Start Date <span class="text-red-500">*</span>
                            </label>
                            {{ form.partnership_start_date }}
                            {% if form.partnership_start_date.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.partnership_start_date.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Banking Information Section -->
            <div class="bg-white shadow-sm rounded-lg border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Banking Information</h3>
                    <p class="text-sm text-gray-600">Payment details and payout preferences</p>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Bank Name
                            </label>
                            {{ form.bank_name }}
                            {% if form.bank_name.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.bank_name.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                IBAN
                            </label>
                            {{ form.iban }}
                            {% if form.iban.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.iban.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Account Number
                            </label>
                            {{ form.bank_account_number }}
                            {% if form.bank_account_number.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.bank_account_number.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Preferred Payout Schedule
                            </label>
                            {{ form.preferred_payout_schedule }}
                            {% if form.preferred_payout_schedule.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.preferred_payout_schedule.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preferences & Assignment Section -->
            <div class="bg-white shadow-sm rounded-lg border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Preferences & Assignment</h3>
                    <p class="text-sm text-gray-600">Communication preferences and team assignments</p>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                BD Executive
                            </label>
                            {{ form.assigned_bd_executive }}
                            {% if form.assigned_bd_executive.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.assigned_bd_executive.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Preferred Communication
                            </label>
                            {{ form.preferred_communication }}
                            {% if form.preferred_communication.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.preferred_communication.errors|first }}
                                </div>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Maintenance Handling
                            </label>
                            {{ form.maintenance_handling }}
                            {% if form.maintenance_handling.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.maintenance_handling.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="flex items-center">
                            <label class="flex items-center">
                                {{ form.guaranteed_rent_preference }}
                                <span class="ml-2 text-sm text-gray-700">Prefers guaranteed rent options</span>
                            </label>
                            {% if form.guaranteed_rent_preference.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {{ form.guaranteed_rent_preference.errors|first }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes Section -->
            <div class="bg-white shadow-sm rounded-lg border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Additional Notes</h3>
                    <p class="text-sm text-gray-600">Any additional information about this landlord</p>
                </div>
                <div class="p-6">
                    {{ form.notes }}
                    {% if form.notes.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {{ form.notes.errors|first }}
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3">
                <a href="{% url 'landlords:landlord_list' %}" class="inline-flex justify-center items-center px-6 py-3 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Cancel
                </a>
                <button type="submit" class="inline-flex justify-center items-center px-6 py-3 rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Create Landlord
                </button>
            </div>
        </form>

</div>

<!-- Form Validation Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add real-time validation feedback
        const form = document.querySelector('form');
        const inputs = form.querySelectorAll('input, select, textarea');
        
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
            });
            
            input.addEventListener('input', function() {
                clearValidationError(this);
            });
        });
        
        function validateField(field) {
            // Add custom validation logic here if needed
            if (field.hasAttribute('required') && !field.value.trim()) {
                showValidationError(field, 'This field is required.');
            }
        }
        
        function showValidationError(field, message) {
            clearValidationError(field);
            const errorElement = document.createElement('p');
            errorElement.className = 'mt-1 text-sm text-red-600 field-error';
            errorElement.textContent = message;
            field.parentNode.appendChild(errorElement);
            field.classList.add('border-red-300', 'focus:ring-red-500', 'focus:border-red-500');
        }
        
        function clearValidationError(field) {
            const errorElement = field.parentNode.querySelector('.field-error');
            if (errorElement) {
                errorElement.remove();
            }
            field.classList.remove('border-red-300', 'focus:ring-red-500', 'focus:border-red-500');
        }
        
        // Auto-generate company name suggestions based on landlord type
        document.querySelector('select[name="landlord_type"]').addEventListener('change', function() {
            const companyNameField = document.querySelector('input[name="company_name"]');
            const selectedType = this.value;
            
            if (selectedType === 'individual') {
                companyNameField.placeholder = 'Leave blank for individual owners';
            } else if (selectedType === 'company') {
                companyNameField.placeholder = 'e.g., Berlin Properties GmbH';
            } else if (selectedType === 'investor') {
                companyNameField.placeholder = 'e.g., Investment Group Name';
            } else if (selectedType === 'institutional') {
                companyNameField.placeholder = 'e.g., Deutsche Wohnen SE';
            }
        });

        // IBAN formatting
        document.querySelector('input[name="iban"]').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s+/g, '').replace(/(.{4})/g, '$1 ');
            if (value.length > 34) {
                value = value.substring(0, 34);
            }
            e.target.value = value.trim().toUpperCase();
        });
    });
</script>
{% endblock %}